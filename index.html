<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <title>NZ Student Hardship</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    
    <script src="assets/lib/tailwind.js"></script>
    <script src="assets/lib/chart.js"></script>
    <script src="assets/lib/annotation.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        ios: { bg: 'var(--bg-color)', card: 'var(--card-bg)', text: 'var(--text-color)' }
                    }
                }
            }
        }
    </script>
</head>
<body class="pb-24 bg-ios-bg text-ios-text transition-colors duration-300">

    <header class="fixed top-0 w-full z-30 pt-12 pb-4 px-4 bg-white/90 dark:bg-[#1C1C1E]/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 transition-colors">
        <h1 id="page-title" class="text-xl font-bold text-center tracking-tight">Calculator</h1>
        <div id="tracker-nav" class="hidden mt-3 text-center"></div>
    </header>

    <main class="max-w-md mx-auto px-4 mt-28">

        <div id="tab-calc" class="active-tab">
            <div class="ios-card p-4">
                <div class="segmented-control mb-4 flex rounded-lg bg-gray-200 dark:bg-gray-800 p-1">
                    <button id="mode-weekly" class="segment-btn active flex-1 py-1 px-3 rounded-md text-xs font-bold transition-all bg-white dark:bg-gray-700 shadow-sm">Weekly</button>
                    <button id="mode-fortnightly" class="segment-btn flex-1 py-1 px-3 rounded-md text-xs font-bold transition-all opacity-60">Fortnight</button>
                    <button id="mode-custom" class="segment-btn flex-1 py-1 px-3 rounded-md text-xs font-bold transition-all opacity-60">Custom</button>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-2">
                    <div>
                        <label class="input-label">Hourly Rate</label>
                        <input id="hourly" type="number" inputmode="decimal" placeholder="0.00" class="input-field text-center font-bold">
                    </div>
                    <div>
                        <label class="input-label">Base Benefit</label>
                        <input id="base-benefit" type="number" inputmode="decimal" value="401" class="input-field text-center font-bold">
                    </div>
                </div>

                <div id="custom-weeks-container" class="hidden mt-2 mb-2">
                    <label class="input-label">Number of Weeks</label>
                    <input id="custom-weeks-count" type="number" pattern="\d*" inputmode="numeric" value="4" class="input-field">
                </div>

                <details class="group mt-2 pt-2 border-t border-gray-100 dark:border-gray-800">
                    <summary class="flex items-center gap-2 cursor-pointer py-2">
                        <span class="text-xs font-medium opacity-60">‚öôÔ∏è Settings (Theme, KS, Loan)</span>
                        <svg class="chevron w-3 h-3 opacity-40 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="space-y-3 pt-3 pb-1">
                        <div class="setting-row">
                            <span>App Theme</span>
                            <select id="themeSelect" class="text-xs bg-transparent border border-gray-300 dark:border-gray-700 rounded p-1"><option value="system">System</option><option value="light">Light</option><option value="dark">Dark</option></select>
                        </div>
                        <div class="setting-row"><span>Holiday Pay (+8%)</span><input type="checkbox" id="hpToggle" class="toggle"></div>
                        <div class="setting-row"><span>Student Loan</span><input type="checkbox" id="slToggle" class="toggle" checked></div>
                        <div class="setting-row">
                            <span>KiwiSaver</span>
                            <div class="flex items-center gap-2">
                                <select id="ksPercent" class="text-xs bg-gray-100 dark:bg-gray-800 rounded px-1"><option value="0.03">3%</option><option value="0.04">4%</option><option value="0.08">8%</option></select>
                                <input type="checkbox" id="ksToggle" class="toggle" checked>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <div class="ios-card p-4">
                 <h2 class="text-xs font-semibold uppercase tracking-wider mb-4 opacity-60">Hours Worked</h2>
                 <div id="week-inputs-container" class="space-y-3"></div>
            </div>

            <button id="calc-btn" class="main-btn">Calculate</button>

            <div id="calc-output" class="hidden pb-4 space-y-4">
                <div id="results-container"></div>
            </div>
        </div>

        <div id="tab-tracker" class="hidden">
            <div class="ios-card p-6 text-center mb-4 border border-gray-200 dark:border-gray-800 relative">
                <div class="text-xs font-bold uppercase opacity-50 mb-1">Current Balance</div>
                <div id="wallet-balance" class="font-black text-4xl tracking-tight">$0.00</div>
            </div>

            <div id="tracker-list" class="space-y-3 pb-20"></div>
            
            <button id="add-txn-fab" class="fixed bottom-24 right-4 bg-blue-500 text-white p-4 rounded-full shadow-lg z-40">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            </button>
        </div>

        <div id="tab-graph" class="hidden">
            <div class="ios-card p-3 mb-4">
                <div class="setting-row mb-2"><span>Show Wages Ghost Line</span><input type="checkbox" id="ghostToggle" class="toggle"></div>
                <div class="setting-row"><span>Graph Pop-up Info</span><input type="checkbox" id="popupToggle" class="toggle" checked></div>
            </div>

            <div class="ios-card p-2">
                <div class="p-2 mb-2"><h3 class="font-bold text-lg">Income Graph</h3><p class="text-xs opacity-60">Visualize benefit drop-off</p></div>
                <div class="chart-container">
                    <canvas id="optChart"></canvas>
                    <div id="graphPopup" class="graph-popup">Info</div>
                </div>
                <div class="px-2 pt-4 pb-2">
                    <input type="range" id="hourSlider" min="0" max="50" value="0" step="1" class="w-full">
                </div>
            </div>
            
            <div id="selected-point-container" class="mb-6 hidden"></div>

            <div class="flex gap-4 justify-center text-[10px] opacity-60 mb-6">
                <div class="flex items-center gap-1"><span class="text-lg leading-none">üü¢</span> Sweet</div>
                <div class="flex items-center gap-1"><span class="text-lg leading-none">üõë</span> Stagnation</div>
                <div class="flex items-center gap-1"><span class="text-lg leading-none">üèÅ</span> Breakout</div>
            </div>

            <div class="ios-card">
                <details class="group">
                    <summary class="flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 transition-colors">
                        <span class="font-medium text-sm">View All Data Table</span>
                        <svg class="chevron w-4 h-4 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="bg-gray-50 dark:bg-[#252525]">
                         <div class="opt-row opt-header">
                            <div>Hours</div><div class="text-center">Sym</div><div class="text-right">Total</div><div class="text-right">Gain</div><div class="text-right">Zone</div>
                        </div>
                        <div id="optimizer-table-body" class="divide-y divide-gray-200 dark:divide-gray-800"></div>
                    </div>
                </details>
            </div>
        </div>

    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" data-tab="calc">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
            Calculator
        </div>
        <div class="nav-item" data-tab="tracker">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
            Tracker
        </div>
        <div class="nav-item" data-tab="graph">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
            Graph
        </div>
    </nav>

    <div id="addModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
        <div class="bg-white dark:bg-[#1C1C1E] w-full max-w-sm rounded-2xl p-4 shadow-2xl slide-up-anim">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg" id="modal-title">Add Transaction</h3>
                <button id="modal-close-btn" class="text-blue-500 font-bold">Close</button>
            </div>
            <div class="space-y-4">
                <input type="hidden" id="t-id">
                <div>
                    <label class="input-label">Amount</label>
                    <input id="t-amount" type="number" step="0.01" class="input-field text-lg font-bold" placeholder="$0.00">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="input-label">Type</label>
                        <select id="t-type" class="input-field"><option value="expense">Expense</option><option value="income">Income</option></select>
                    </div>
                    <div>
                        <label class="input-label">Date</label>
                        <input id="t-date" type="date" class="input-field">
                    </div>
                </div>
                <div>
                    <label class="input-label">Label</label>
                    <input id="t-label" type="text" class="input-field" placeholder="e.g. Rent, Wages">
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <button id="delete-btn" class="hidden w-full bg-red-100 text-red-500 font-bold py-3 rounded-xl mt-2">Delete</button>
                    <button id="save-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl mt-2 col-span-2">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
